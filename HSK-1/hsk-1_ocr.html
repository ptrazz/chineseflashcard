<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tebak Hanzi — Penilaian Mandiri</title>
<style>
 body{font-family:system-ui;background:#0d1117;color:#eee;margin:0;padding:20px;text-align:center}
 .card{max-width:500px;margin:auto;background:#161b22;padding:20px;border-radius:14px;box-shadow:0 0 20px #0007}
 button{padding:10px 18px;border-radius:8px;border:none;margin:5px;font-size:16px;cursor:pointer;transition:transform 0.1s}
 button:active{transform:scale(.96)}
 button:disabled{cursor:not-allowed} 
 /* Styles for specific action buttons */
 #btnBenar { background:#238636; color:white; }
 #btnSalah { background:#db3939; color:white; }
 #btnShowAnswer { background:#30436d; color:white; }
 #hanziPad{width:100%;height:300px;background:white;border-radius:12px;border:2px solid #555;touch-action:none}
 .jawaban{font-size:48px;margin:15px 0;color:#4ad86e}
 .progress{width:100%;height:10px;background:#333;border-radius:6px;overflow:hidden;margin-top:10px}
 .bar{height:100%;width:0;background:#238636;transition:width 0.3s} 

 /* Container untuk tombol penilaian */
 .assessment-buttons {
     display: flex;
     justify-content: center;
     gap: 10px;
     margin-top: 15px;
 }
 .assessment-buttons button {
     width: 48%; /* Agar tombol memakan hampir setengah lebar */
 }
</style>
</head>
<body>
<h1>Tebak Hanzi — Penilaian Mandiri</h1>
<div class="card">
 <div id="showPinyin" style="font-size:32px;color:#7ff9a1;margin-bottom:4px"></div>
 <div id="showEnglish" style="font-size:20px;color:#cbd5e1;margin-bottom:14px"></div>
 
 <div class="progress">
     <div id="bar" class="bar"></div>
 </div>

 <div style="margin: 15px 0;">
    <span id="progressText" style="font-size:14px; color:#aaa;">0/20 selesai</span>
 </div>
 
 <h3>Gambar Hanzi:</h3>
 <canvas id="hanziPad"></canvas>

 <br>
 <button onclick="clearPad()">Hapus Gambar</button>
 <button id="btnShowAnswer" onclick="showAnswer()">Tampilkan Jawaban</button>
 
 <div id="notif" style="margin:10px 0 20px; color:#ddd"></div>
 
 <div id="jawaban" class="jawaban"></div>

 <div class="assessment-buttons">
    <button id="btnBenar" onclick="processAnswer(true)">✅ Benar</button>
    <button id="btnSalah" onclick="processAnswer(false)">❌ Salah</button>
 </div>
 
 <div style="margin-top:20px">
   <button onclick="prevCard()">Kembali</button>
   <button onclick="nextCard()">Lanjut</button>
 </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script>
let data = HSK1();
// Menggunakan array of objects untuk melacak status dan jawaban pengguna
let session = data.map((item, index) => ({ 
    ...item, 
    id: index, 
    status: 'pending' // 'pending', 'correct', 'incorrect'
}));

// Mengacak urutan yang hanya digunakan untuk iterasi, status tetap di `session`
let order = [...Array(data.length).keys()].sort(()=>Math.random()-0.5); 
let index = 0; // Index ke array 'order'
let score = 0; // Total jawaban benar

let canvas = document.getElementById('hanziPad');
let signaturePad;

// Storing DOM elements
const showPinyinEl = document.getElementById('showPinyin');
const showEnglishEl = document.getElementById('showEnglish');
const jawabanEl = document.getElementById('jawaban');
const notifEl = document.getElementById('notif');
const barEl = document.getElementById('bar');
const progressTextEl = document.getElementById('progressText');


function HSK1(){
 return [
 {hanzi:"八", pinyin:"bā", eng:"eight"},
 {hanzi:"爸爸", pinyin:"bàba", eng:"father"},
 {hanzi:"杯子", pinyin:"bēizi", eng:"cup, glass"},
 {hanzi:"北京", pinyin:"Běijīng", eng:"Beijing"},
 {hanzi:"本", pinyin:"běn", eng:"measure word for books"},
 {hanzi:"不", pinyin:"bù", eng:"not, no"},
 {hanzi:"不客气", pinyin:"bú kèqi", eng:"you’re welcome"},
 {hanzi:"菜", pinyin:"cài", eng:"dish, vegetable"},
 {hanzi:"茶", pinyin:"chá", eng:"tea"},
 {hanzi:"吃", pinyin:"chī", eng:"to eat"},
 {hanzi:"出租车", pinyin:"chūzūchē", eng:"taxi"},
 {hanzi:"打电话", pinyin:"dǎ diànhuà", eng:"to make a phone call"},
 {hanzi:"大", pinyin:"dà", eng:"big"},
 {hanzi:"的", pinyin:"de", eng:"possessive particle"},
 {hanzi:"点", pinyin:"diǎn", eng:"o’clock"},
 {hanzi:"电脑", pinyin:"diànnǎo", eng:"computer"},
 {hanzi:"电视", pinyin:"diànshì", eng:"television"},
 {hanzi:"电影", pinyin:"diànyǐng", eng:"movie"},
 {hanzi:"东西", pinyin:"dōngxi", eng:"thing, object"},
 {hanzi:"都", pinyin:"dōu", eng:"all"}
 ];
}

function resizeCanvas(){
 const ratio = window.devicePixelRatio || 1;
 canvas.width = canvas.clientWidth * ratio;
 canvas.height = canvas.clientHeight * ratio;
 const ctx = canvas.getContext("2d");
 ctx.scale(ratio, ratio);
 if(signaturePad){ 
    signaturePad._ctx = ctx; 
    signaturePad.clear(); 
 }
}

function init(){
 resizeCanvas();
 signaturePad = new SignaturePad(canvas,{backgroundColor:'white',penColor:'black'});
 updateProgress();
 tampilkan();
}

window.onload = init;
window.onresize = resizeCanvas;

function tampilkan(){
 let itemIndex = order[index];
 let item = session[itemIndex];

 showPinyinEl.textContent = item.pinyin;
 showEnglishEl.textContent = item.eng;
 jawabanEl.innerHTML = "";
 notifEl.innerHTML = "";
 clearPad();
 
 // Menampilkan status sebelumnya (jika ada)
 if (item.status === 'correct') {
     notifEl.innerHTML = "<span style='color:#4ad86e'>Sudah dijawab dengan Benar!</span>";
 } else if (item.status === 'incorrect') {
     notifEl.innerHTML = "<span style='color:#ff5757'>Sudah dijawab dengan Salah. Coba lagi!</span>";
 } else {
     notifEl.innerHTML = "Silakan gambar Hanzi di atas.";
 }
}

function nextCard(){ 
    if(index < order.length-1){ 
        index++; 
        tampilkan(); 
    } else {
        notifEl.innerHTML = "<span style='color:orange'>Semua kartu sudah selesai. Silakan kembali ke kartu sebelumnya.</span>";
    }
}

function prevCard(){ 
    if(index > 0){ 
        index--; 
        tampilkan(); 
    } else {
        notifEl.innerHTML = "<span style='color:orange'>Ini adalah kartu pertama.</span>";
    }
}

function showAnswer(){ 
    jawabanEl.innerHTML = session[order[index]].hanzi;
    notifEl.innerHTML = "Ini adalah jawaban yang benar. Apakah gambarmu sudah mirip?";
}

function clearPad(){ signaturePad.clear(); }

// Fungsi untuk memperbarui status dan melanjutkan ke kartu berikutnya
function processAnswer(isCorrect) {
    let itemIndex = order[index];
    let currentItem = session[itemIndex];
    
    // Hanya perbarui status jika sebelumnya belum pernah dijawab BENAR
    if (currentItem.status !== 'correct') {
        currentItem.status = isCorrect ? 'correct' : 'incorrect';
    }

    if (isCorrect) {
        notifEl.innerHTML = "<span style='color:#4ad86e'>Bagus! Lanjut ke kartu berikutnya.</span>";
        jawabanEl.innerHTML = currentItem.hanzi;
    } else {
        notifEl.innerHTML = "<span style='color:#ff5757'>Oke. Pelajari lagi dan coba gambar ulang, atau lanjut ke kartu berikutnya.</span>";
    }
    
    updateProgress();
    
    // Pindah ke kartu berikutnya setelah jeda singkat
    setTimeout(nextCard, 1500);
}

function updateProgress(){
    let total = session.length;
    let answered = session.filter(item => item.status !== 'pending').length;
    let correctCount = session.filter(item => item.status === 'correct').length;
    
    let pct = (answered / total) * 100;
    barEl.style.width = pct + "%";
    
    progressTextEl.textContent = `${correctCount}/${total} benar (${answered} selesai)`;
    
    // Perbarui warna progress bar berdasarkan persentase
    if (pct < 50) {
         barEl.style.backgroundColor = '#db3939'; // Merah
    } else if (pct < 100) {
         barEl.style.backgroundColor = '#ffc107'; // Kuning
    } else {
         barEl.style.backgroundColor = '#238636'; // Hijau
    }
}
</script>
</body>
</html>
